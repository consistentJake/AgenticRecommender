[0m[22:00:13] [INFO] [0m
[0m[22:00:13] [INFO] ################################################################################[0m
[0m[22:00:13] [INFO] #                                                                              #[0m
[0m[22:00:13] [INFO] #                                WORKFLOW RUNNER                               #[0m
[0m[22:00:13] [INFO] #                     Food Delivery Recommendation Pipeline                    #[0m
[0m[22:00:13] [INFO] #                                                                              #[0m
[0m[22:00:13] [INFO] ################################################################################[0m
[0m[22:00:13] [INFO] 
Running enabled stages: ['load_data', 'build_users', 'build_cuisines', 'run_enhanced_rerank_evaluation'][0m
[0m[22:00:13] [INFO] 
Stage Plan:[0m
[0m[22:00:13] [INFO]   1. load_data: Load and merge Singapore food delivery data[0m
[0m[22:00:13] [INFO]   2. build_users: Create EnrichedUser representations for all users[0m
[0m[22:00:13] [INFO]   3. build_cuisines: Build cuisine profiles for temporal patterns[0m
[0m[22:00:13] [INFO]   4. run_enhanced_rerank_evaluation: Two-round LLM reranking with LightGCN reflection[0m
[0m[22:00:13] [INFO] [0m
[94m[22:00:13] [START] ======================================================================[0m
[94m[22:00:13] [START] STAGE: load_data[0m
[94m[22:00:13] [START] Description: Load and merge Singapore food delivery data[0m
[94m[22:00:13] [START] ======================================================================[0m
[0m[22:00:13] [INFO] Loading data from: /home/zhenkai/Downloads/data_se/data_se/[0m
[96m[22:00:13] [FILE] READING: /home/zhenkai/Downloads/data_se/data_se//orders_sg_train.txt (N/A) - Loading orders[0m
[96m[22:00:13] [FILE] READING: /home/zhenkai/Downloads/data_se/data_se//vendors_sg.txt (N/A) - Loading vendors[0m
[96m[22:00:13] [FILE] READING: /home/zhenkai/Downloads/data_se/data_se//products_sg.txt (N/A) - Loading products[0m
[0m[22:00:14] [INFO] Merged data shape: (617196, 17)[0m
[0m[22:00:14] [INFO] Columns: ['Unnamed: 0', 'customer_id', 'user_geohash', 'order_id', 'vendor_id', 'product_id', 'day_of_week', 'order_time', 'order_day', 'hour', 'day_num', 'day_name', 'cuisine', 'vendor_geohash', 'chain_id', 'product_name', 'unit_price'][0m
[0m[22:00:14] [INFO] Dataset Statistics:[0m
[0m[22:00:14] [INFO]   total_rows: 617,196[0m
[0m[22:00:14] [INFO]   unique_customers: 109,544[0m
[0m[22:00:14] [INFO]   unique_orders: 325,937[0m
[0m[22:00:14] [INFO]   unique_vendors: 1,128[0m
[0m[22:00:14] [INFO]   unique_cuisines: 39[0m
[0m[22:00:14] [INFO]   unique_products: 39,188[0m
[0m[22:00:14] [INFO]   avg_items_per_order: 1.89[0m
[96m[22:00:15] [FILE] WRITING: outputs/stage1_merged_data.parquet (15.1 MB) - 617,196 rows[0m
[0m[22:00:15] [INFO] Creating JSON preview with 1000 rows...[0m
[96m[22:00:15] [FILE] WRITING: outputs/stage1_merged_preview.json (488.6 KB) - 1000 rows preview[0m
[96m[22:00:15] [FILE] WRITING: outputs/stage1_stats.json (207.0 B) - Dataset statistics[0m
[92m[22:00:15] [SUCCESS] STAGE load_data COMPLETED in 1.64s[0m
[92m[22:00:15] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:00:15] [INFO] [0m
[94m[22:00:15] [START] ======================================================================[0m
[94m[22:00:15] [START] STAGE: build_users[0m
[94m[22:00:15] [START] Description: Create EnrichedUser representations for all users[0m
[94m[22:00:15] [START] ======================================================================[0m
[0m[22:00:15] [INFO] Output file already exists: outputs/stage2_enriched_users.json[0m
[0m[22:00:15] [INFO] Skipping build_users stage. Delete the file to reprocess.[0m
[92m[22:00:15] [SUCCESS] STAGE build_users COMPLETED in 0.00s[0m
[92m[22:00:15] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:00:15] [INFO] [0m
[94m[22:00:15] [START] ======================================================================[0m
[94m[22:00:15] [START] STAGE: build_cuisines[0m
[94m[22:00:15] [START] Description: Build cuisine profiles for temporal patterns[0m
[94m[22:00:15] [START] ======================================================================[0m
[96m[22:00:15] [FILE] READING: outputs/stage1_merged_data.parquet (15.1 MB) - Loading merged data[0m
[0m[22:00:15] [INFO] Building cuisine profiles...[0m
Built profiles for 39 cuisines
[92m[22:00:16] [SUCCESS] Built 39 cuisine profiles[0m
[0m[22:00:16] [INFO] Top cuisines by order count:[0m
[0m[22:00:16] [INFO]   pizza: 71,835 orders[0m
[0m[22:00:16] [INFO]   burgare: 62,198 orders[0m
[0m[22:00:16] [INFO]   asiatiskt: 32,796 orders[0m
[0m[22:00:16] [INFO]   sushi: 19,187 orders[0m
[0m[22:00:16] [INFO]   indiskt: 19,013 orders[0m
[96m[22:00:16] [FILE] WRITING: outputs/stage3_cuisine_profiles.json (60.1 KB) - 39 cuisines[0m
[96m[22:00:16] [FILE] WRITING: outputs/stage3_cuisine_profiles_preview.json (18.7 KB) - 10 records preview[0m
[92m[22:00:16] [SUCCESS] STAGE build_cuisines COMPLETED in 0.75s[0m
[92m[22:00:16] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:00:16] [INFO] [0m
[94m[22:00:16] [START] ======================================================================[0m
[94m[22:00:16] [START] STAGE: run_enhanced_rerank_evaluation[0m
[94m[22:00:16] [START] Description: Two-round LLM reranking with LightGCN reflection[0m
[94m[22:00:16] [START] ======================================================================[0m
[96m[22:00:16] [FILE] READING: outputs/stage1_merged_data.parquet (15.1 MB) - Loading merged data for enhanced rerank evaluation[0m
[0m[22:00:16] [INFO] Loaded 617,196 rows[0m
[0m[22:00:16] [INFO] [0m
[0m[22:00:16] [INFO] ============================================================[0m
[0m[22:00:16] [INFO] BUILDING TEST SAMPLES[0m
[0m[22:00:16] [INFO] ============================================================[0m
[92m[22:00:16] [SUCCESS] Created 10 test samples[0m
[96m[22:00:16] [FILE] WRITING: outputs/stage8_enhanced_rerank_samples.json (12.3 KB) - 10 test samples[0m
[0m[22:00:16] [INFO] [0m
[0m[22:00:16] [INFO] ============================================================[0m
[0m[22:00:16] [INFO] BUILDING CUISINE-CUISINE SWING MODEL[0m
[0m[22:00:16] [INFO] ============================================================[0m
[CuisineBasedGenerator] Building swing model from 325937 interactions...
[CuisineBasedGenerator] Fitted: 39 cuisines, 109544 users
[0m[22:00:17] [INFO] Generator stats: {'fitted': True, 'swing_stats': {'method': 'cuisine_swing', 'fitted': True, 'cache_size': 0, 'config': {'top_k': 10, 'min_threshold': 0.0, 'cache_enabled': True}, 'num_cuisines': 39, 'num_users': 109544, 'total_interactions': 193792, 'avg_cuisines_per_user': 1.7690790915066092, 'avg_users_per_cuisine': 4969.025641025641}}[0m
[0m[22:00:17] [INFO] [0m
[0m[22:00:17] [INFO] ============================================================[0m
[0m[22:00:17] [INFO] LOADING/TRAINING LIGHTGCN EMBEDDINGS[0m
[0m[22:00:17] [INFO] ============================================================[0m
[0m[22:00:17] [INFO] Total interactions for LightGCN: 325937[0m
[LightGCNManager] Found cache at /home/zhenkai/.cache/agentic_recommender/lightgcn/data_se_embeddings.pkl
[LightGCNManager] Cache key matches, loading embeddings...
[0m[22:00:17] [INFO] LightGCN stats: {'fitted': True, 'num_users': 109544, 'num_cuisines': 39, 'embedding_dim': 64, 'n_layers': 3, 'cache_key': 'e7bbc21597e03bb9a21bc1c70dab3213'}[0m
[0m[22:00:17] [INFO] [0m
[0m[22:00:17] [INFO] ============================================================[0m
[0m[22:00:17] [INFO] INITIALIZING LLM PROVIDER[0m
[0m[22:00:17] [INFO] ============================================================[0m
[0m[22:00:17] [INFO] Provider type: openrouter[0m
[92m[22:00:17] [SUCCESS] Initialized OpenRouter[0m
[0m[22:00:17] [INFO] [0m
[0m[22:00:17] [INFO] ============================================================[0m
[0m[22:00:17] [INFO] RUNNING ENHANCED TWO-ROUND EVALUATION[0m
[0m[22:00:17] [INFO] ============================================================[0m
[0m[22:00:17] [INFO] Samples: 10, Candidates: 20[0m

[1/10] Customer: 3097f3b1ff
  Candidates: 9
  GT rank: 2, added: True
  Round 1 rank: 2
  Round 2 (final) rank: 1
  Time: 3716.77ms

[2/10] Customer: 0ad4c8de01
  Candidates: 8
  GT rank: 7, added: True
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 3958.92ms

[3/10] Customer: 7a79cfbcb0
  Candidates: 6
  GT rank: 5, added: True
  Round 1 rank: 4
  Round 2 (final) rank: 1
  Time: 3151.08ms

[4/10] Customer: 6c6a1d2c7f
  Candidates: 6
  GT rank: 2, added: True
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 2706.49ms

[5/10] Customer: 62a29e83ed
  Candidates: 8
  GT rank: 3, added: False
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 3801.20ms

[6/10] Customer: 3d6bf79aa6
  Candidates: 7
  GT rank: 1, added: False
  Round 1 rank: 2
  Round 2 (final) rank: 1
  Time: 3983.78ms

[7/10] Customer: 2ce1f1d7ba
  Candidates: 6
  GT rank: 2, added: True
  Round 1 rank: 5
  Round 2 (final) rank: 3
  Time: 3468.08ms

[8/10] Customer: f3c6aceec5
  Candidates: 6
  GT rank: 2, added: False
  Round 1 rank: 2
  Round 2 (final) rank: 1
  Time: 3310.18ms

[9/10] Customer: 25e02fadab
  Candidates: 11
  GT rank: 4, added: True
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 4186.13ms

[10/10] Customer: bdc0d11150
  Candidates: 6
  GT rank: 4, added: False
  Round 1 rank: 4
  Round 2 (final) rank: 1
  Time: 3260.89ms
[0m[22:00:52] [INFO] [0m
[0m[22:00:52] [INFO] ============================================================[0m
[0m[22:00:52] [INFO] ENHANCED RERANK EVALUATION RESULTS[0m
[0m[22:00:52] [INFO] ============================================================[0m
[0m[22:00:52] [INFO]   NDCG@5:       0.9500[0m
[0m[22:00:52] [INFO]   NDCG@10:      0.9500[0m
[0m[22:00:52] [INFO]   MRR@5:        0.9333[0m
[0m[22:00:52] [INFO]   MRR@10:       0.9333[0m
[0m[22:00:52] [INFO]   Hit@1:        90.00%[0m
[0m[22:00:52] [INFO]   Hit@3:        100.00%[0m
[0m[22:00:52] [INFO]   Hit@5:        100.00%[0m
[0m[22:00:52] [INFO]   Hit@10:       100.00%[0m
[0m[22:00:52] [INFO]   Round1 Hit@5: 100.00%[0m
[0m[22:00:52] [INFO]   Final Hit@5:  100.00%[0m
[0m[22:00:52] [INFO]   Improvement:  +0.00%[0m
[0m[22:00:52] [INFO]   GT in Candidates: 40.00%[0m
[0m[22:00:52] [INFO]   Samples: 10/10[0m
[0m[22:00:52] [INFO]   Avg Time: 3554.35ms[0m
[96m[22:00:52] [FILE] WRITING: outputs/stage8_enhanced_rerank_results.json (343.0 B) - Enhanced rerank evaluation metrics[0m
[96m[22:00:52] [FILE] WRITING: outputs/stage8_enhanced_rerank_detailed.json (71.5 KB) - 10 detailed results[0m
[96m[22:00:52] [FILE] WRITING: outputs/stage8_enhanced_rerank_detailed_preview.json (24.1 KB) - 3 records preview[0m
[92m[22:00:52] [SUCCESS] STAGE run_enhanced_rerank_evaluation COMPLETED in 36.93s[0m
[92m[22:00:52] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:00:52] [INFO] [0m
[0m[22:00:52] [INFO] ################################################################################[0m
[0m[22:00:52] [INFO] WORKFLOW COMPLETE[0m
[0m[22:00:52] [INFO] ################################################################################[0m
[0m[22:00:52] [INFO] 
Total time: 39.38s[0m
[0m[22:00:52] [INFO] 
Results:[0m
[0m[22:00:52] [INFO]   load_data: SUCCESS[0m
[0m[22:00:52] [INFO]   build_users: SUCCESS[0m
[0m[22:00:52] [INFO]   build_cuisines: SUCCESS[0m
[0m[22:00:52] [INFO]   run_enhanced_rerank_evaluation: SUCCESS[0m
