Question:
Swing can’t be used to calculate user/item similarity right?



Here is a detailed, step-by-step example of **Rank-Based Merging** (specifically a technique often called **Reciprocal Rank Fusion**).

This example demonstrates how this method saves "Niche" recommendations from being drowned out by "Popular" recommendations.

---

### Scenario Setup

Imagine a user has interactions with only **2 items** in their history.
1.  **History Item A (Niche):** `Vintage Typewriter` (Very few users buy this).
2.  **History Item B (Popular):** `iPhone 15 Case` (Millions of users buy this).

You run your Swing Similarity algorithm on both items to get the top 3 candidates for each ($K=3$).

### Step 1: The Raw Data (The Problem)

Because the `iPhone Case` has so much data, its Swing scores are massive. The `Vintage Typewriter` has sparse data, so its Swing scores are tiny, even for perfect matches.

**List A: Candidates from "Vintage Typewriter"**
| Rank | Candidate Item | Raw Swing Score | Relationship |
| :--- | :--- | :--- | :--- |
| 1 | **Ink Ribbon** | **12.5** | Perfect match |
| 2 | Fancy Paper | 8.0 | Good match |
| 3 | *Cleaning Cloth* | 4.0 | Weak match |

**List B: Candidates from "iPhone 15 Case"**
| Rank | Candidate Item | Raw Swing Score | Relationship |
| :--- | :--- | :--- | :--- |
| 1 | **Screen Protector**| **5,000.0** | Perfect match |
| 2 | USB-C Cable | 4,200.0 | Good match |
| 3 | *Cleaning Cloth* | 900.0 | Weak match |

---

### Step 2: The Failure of the Naïve Approach

If you use your original proposal (sorting by Raw Swing Score), you merge the lists and sort descending.

**The Naïve Top 5:**
1.  Screen Protector (5,000.0)
2.  USB-C Cable (4,200.0)
3.  Cleaning Cloth (900.0)
4.  *(Ink Ribbon is skipped - Score 12.5)*
5.  *(Fancy Paper is skipped - Score 8.0)*

**The Result:** The user sees only iPhone accessories. The system completely ignored their specific interest in Typewriters because the math favored the popular item.

---

### Step 3: Rank-Based Merging (The Solution)

Instead of looking at the *value* (5,000 vs 12), we look at the **Rank**.
We calculate a new score using **Reciprocal Rank Fusion (RRF)**.

**The Formula:**
$$ \text{FinalScore}(item) = \sum_{h \in \text{History}} \frac{1}{k + \text{rank}(item, h)} $$

*   **rank(item, h):** The position of the candidate in the list generated by history item $h$.
*   **k:** A constant to smooth the variance (often set to 0, 1, or 60). *For this simple example, we will set **k = 0**.*

#### Calculation:

**1. Candidate: Ink Ribbon**
*   Source: Vintage Typewriter (Rank 1)
*   Source: iPhone Case (Not present)
*   Calculation: $1/1 = 1.0$
*   **Final Score: 1.0**

**2. Candidate: Screen Protector**
*   Source: Vintage Typewriter (Not present)
*   Source: iPhone Case (Rank 1)
*   Calculation: $1/1 = 1.0$
*   **Final Score: 1.0**

**3. Candidate: Fancy Paper**
*   Source: Vintage Typewriter (Rank 2)
*   Calculation: $1/2 = 0.5$
*   **Final Score: 0.5**

**4. Candidate: USB-C Cable**
*   Source: iPhone Case (Rank 2)
*   Calculation: $1/2 = 0.5$
*   **Final Score: 0.5**

**5. Candidate: Cleaning Cloth (The Overlap)**
*   *Note: This item appears in BOTH lists.*
*   Source: Vintage Typewriter (Rank 3) $\rightarrow 1/3 = 0.33$
*   Source: iPhone Case (Rank 3) $\rightarrow 1/3 = 0.33$
*   Calculation: $0.33 + 0.33 = 0.66$
*   **Final Score: 0.66**

---

### Step 4: The Final Ranked List

Now we sort by the **Rank-Based Score**.

| Final Rank | Item | RRF Score | Logic |
| :--- | :--- | :--- | :--- |
| **1 (Tie)** | **Ink Ribbon** | **1.0** | Top pick for Niche Interest |
| **1 (Tie)** | **Screen Protector** | **1.0** | Top pick for Popular Interest |
| **3** | **Cleaning Cloth** | **0.66** | Relevant to **both** interests |
| 4 (Tie) | Fancy Paper | 0.5 | 2nd pick for Niche Interest |
| 4 (Tie) | USB-C Cable | 0.5 | 2nd pick for Popular Interest |

### Why this is Theoretically Sound

1.  **Fairness:** The `Ink Ribbon` (Score 1.0) is now equal to the `Screen Protector` (Score 1.0). The system respects the user's Typewriter hobby just as much as their phone purchase.
2.  **Reinforcement:** The `Cleaning Cloth` jumped up to position #3. Even though it was the lowest ranked item in both individual lists, the fact that it was recommended by **two different history items** is a strong signal that it is a safe, relevant recommendation. Rank merging captures this naturally via summation.
3.  **Unitless:** Ranks are unitless. Rank 1 is always Rank 1, regardless of whether the underlying Swing score was 5,000 or 12.

### Implementation Tip (The Constant 'k')
In production, we usually use a constant $k$ (e.g., 60) in the formula: $\frac{1}{60 + \text{rank}}$.
This prevents the top items (Rank 1) from dominating too hard compared to Rank 2 or 3. However, for your specific case of balancing Niche vs. Popular, a smaller $k$ (like 1 or 5) is often better to keep the "Top Pick" signal strong.

