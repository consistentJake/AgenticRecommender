[0m[22:24:30] [INFO] [0m
[0m[22:24:30] [INFO] ################################################################################[0m
[0m[22:24:30] [INFO] #                                                                              #[0m
[0m[22:24:30] [INFO] #                                WORKFLOW RUNNER                               #[0m
[0m[22:24:30] [INFO] #                     Food Delivery Recommendation Pipeline                    #[0m
[0m[22:24:30] [INFO] #                                                                              #[0m
[0m[22:24:30] [INFO] ################################################################################[0m
[0m[22:24:30] [INFO] [0m
[0m[22:24:30] [INFO] Run timestamp: 202601222224[0m
[0m[22:24:30] [INFO] Output directory: outputs/202601222224[0m
[0m[22:24:30] [INFO] 
Running enabled stages: ['load_data', 'build_users', 'build_cuisines', 'run_enhanced_rerank_evaluation'][0m
[0m[22:24:30] [INFO] 
Stage Plan:[0m
[0m[22:24:30] [INFO]   1. load_data: Load and merge Singapore food delivery data[0m
[0m[22:24:30] [INFO]   2. build_users: Create EnrichedUser representations for all users[0m
[0m[22:24:30] [INFO]   3. build_cuisines: Build cuisine profiles for temporal patterns[0m
[0m[22:24:30] [INFO]   4. run_enhanced_rerank_evaluation: Two-round LLM reranking with LightGCN reflection[0m
[0m[22:24:30] [INFO] [0m
[94m[22:24:30] [START] ======================================================================[0m
[94m[22:24:30] [START] STAGE: load_data[0m
[94m[22:24:30] [START] Description: Load and merge Singapore food delivery data[0m
[94m[22:24:30] [START] ======================================================================[0m
[0m[22:24:30] [INFO] Loading data from: /home/zhenkai/Downloads/data_se/data_se/[0m
[96m[22:24:30] [FILE] READING: /home/zhenkai/Downloads/data_se/data_se//orders_sg_train.txt (N/A) - Loading orders[0m
[96m[22:24:30] [FILE] READING: /home/zhenkai/Downloads/data_se/data_se//vendors_sg.txt (N/A) - Loading vendors[0m
[96m[22:24:30] [FILE] READING: /home/zhenkai/Downloads/data_se/data_se//products_sg.txt (N/A) - Loading products[0m
[0m[22:24:31] [INFO] Merged data shape: (617196, 17)[0m
[0m[22:24:31] [INFO] Columns: ['Unnamed: 0', 'customer_id', 'user_geohash', 'order_id', 'vendor_id', 'product_id', 'day_of_week', 'order_time', 'order_day', 'hour', 'day_num', 'day_name', 'cuisine', 'vendor_geohash', 'chain_id', 'product_name', 'unit_price'][0m
[0m[22:24:31] [INFO] Dataset Statistics:[0m
[0m[22:24:31] [INFO]   total_rows: 617,196[0m
[0m[22:24:31] [INFO]   unique_customers: 109,544[0m
[0m[22:24:31] [INFO]   unique_orders: 325,937[0m
[0m[22:24:31] [INFO]   unique_vendors: 1,128[0m
[0m[22:24:31] [INFO]   unique_cuisines: 39[0m
[0m[22:24:31] [INFO]   unique_products: 39,188[0m
[0m[22:24:31] [INFO]   avg_items_per_order: 1.89[0m
[96m[22:24:31] [FILE] WRITING: outputs/202601222224/stage1_merged_data.parquet (15.1 MB) - 617,196 rows[0m
[0m[22:24:31] [INFO] Creating JSON preview with 1000 rows...[0m
[96m[22:24:31] [FILE] WRITING: outputs/202601222224/stage1_merged_preview.json (488.6 KB) - 1000 rows preview[0m
[96m[22:24:31] [FILE] WRITING: outputs/202601222224/stage1_stats.json (207.0 B) - Dataset statistics[0m
[92m[22:24:31] [SUCCESS] STAGE load_data COMPLETED in 1.61s[0m
[92m[22:24:31] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:24:32] [INFO] [0m
[94m[22:24:32] [START] ======================================================================[0m
[94m[22:24:32] [START] STAGE: build_users[0m
[94m[22:24:32] [START] Description: Create EnrichedUser representations for all users[0m
[94m[22:24:32] [START] ======================================================================[0m
[96m[22:24:32] [FILE] READING: outputs/202601222224/stage1_merged_data.parquet (15.1 MB) - Loading merged data[0m
[0m[22:24:32] [INFO] Loaded 617,196 rows[0m
[0m[22:24:32] [INFO] Customers with >= 5 orders: 18,766[0m
[0m[22:24:32] [INFO] Building representations for 18766 users...[0m
[0m[22:24:32] [INFO] Using optimized groupby approach...[0m
[0m[22:24:32] [INFO]   Processing user 1/18766 (0.0%)[0m
[0m[22:24:39] [INFO]   Processing user 5000/18766 (26.6%)[0m
[0m[22:24:46] [INFO]   Processing user 10000/18766 (53.3%)[0m
[0m[22:24:53] [INFO]   Processing user 15000/18766 (79.9%)[0m
[0m[22:24:59] [INFO]   Processing user 18766/18766 (100.0%)[0m
[92m[22:24:59] [SUCCESS] Built 18766 user representations[0m
[96m[22:24:59] [FILE] WRITING: outputs/202601222224/stage2_enriched_users.json (43.1 MB) - 18766 users[0m
[96m[22:24:59] [FILE] WRITING: outputs/202601222224/stage2_enriched_users_preview.json (23.3 KB) - 10 records preview[0m
[96m[22:24:59] [FILE] WRITING: outputs/202601222224/stage2_users_summary.json (166.0 B) - User summary statistics[0m
[92m[22:24:59] [SUCCESS] STAGE build_users COMPLETED in 27.82s[0m
[92m[22:24:59] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:24:59] [INFO] [0m
[94m[22:24:59] [START] ======================================================================[0m
[94m[22:24:59] [START] STAGE: build_cuisines[0m
[94m[22:24:59] [START] Description: Build cuisine profiles for temporal patterns[0m
[94m[22:24:59] [START] ======================================================================[0m
[96m[22:24:59] [FILE] READING: outputs/202601222224/stage1_merged_data.parquet (15.1 MB) - Loading merged data[0m
[0m[22:24:59] [INFO] Building cuisine profiles...[0m
Built profiles for 39 cuisines
[92m[22:25:00] [SUCCESS] Built 39 cuisine profiles[0m
[0m[22:25:00] [INFO] Top cuisines by order count:[0m
[0m[22:25:00] [INFO]   pizza: 71,835 orders[0m
[0m[22:25:00] [INFO]   burgare: 62,198 orders[0m
[0m[22:25:00] [INFO]   asiatiskt: 32,796 orders[0m
[0m[22:25:00] [INFO]   sushi: 19,187 orders[0m
[0m[22:25:00] [INFO]   indiskt: 19,013 orders[0m
[96m[22:25:00] [FILE] WRITING: outputs/202601222224/stage3_cuisine_profiles.json (60.1 KB) - 39 cuisines[0m
[96m[22:25:00] [FILE] WRITING: outputs/202601222224/stage3_cuisine_profiles_preview.json (18.7 KB) - 10 records preview[0m
[92m[22:25:00] [SUCCESS] STAGE build_cuisines COMPLETED in 0.74s[0m
[92m[22:25:00] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:25:00] [INFO] [0m
[94m[22:25:00] [START] ======================================================================[0m
[94m[22:25:00] [START] STAGE: run_enhanced_rerank_evaluation[0m
[94m[22:25:00] [START] Description: Two-round LLM reranking with LightGCN reflection[0m
[94m[22:25:00] [START] ======================================================================[0m
[96m[22:25:01] [FILE] READING: outputs/202601222224/stage1_merged_data.parquet (15.1 MB) - Loading merged data for enhanced rerank evaluation[0m
[0m[22:25:01] [INFO] Loaded 617,196 rows[0m
[0m[22:25:01] [INFO] [0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] BUILDING TEST SAMPLES[0m
[0m[22:25:01] [INFO] ============================================================[0m
[92m[22:25:01] [SUCCESS] Created 10 test samples[0m
[96m[22:25:01] [FILE] WRITING: outputs/202601222224/stage8_enhanced_rerank_samples.json (12.3 KB) - 10 test samples[0m
[0m[22:25:01] [INFO] [0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] BUILDING CUISINE-CUISINE SWING MODEL[0m
[0m[22:25:01] [INFO] ============================================================[0m
[CuisineBasedGenerator] Building swing model from 325937 interactions...
[CuisineBasedGenerator] Fitted: 39 cuisines, 109544 users
[0m[22:25:01] [INFO] Generator stats: {'fitted': True, 'swing_stats': {'method': 'cuisine_swing', 'fitted': True, 'cache_size': 0, 'config': {'top_k': 10, 'min_threshold': 0.0, 'cache_enabled': True}, 'num_cuisines': 39, 'num_users': 109544, 'total_interactions': 193792, 'avg_cuisines_per_user': 1.7690790915066092, 'avg_users_per_cuisine': 4969.025641025641}}[0m
[0m[22:25:01] [INFO] [0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] LOADING/TRAINING LIGHTGCN EMBEDDINGS[0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] Total interactions for LightGCN: 325937[0m
[LightGCNManager] Found cache at /home/zhenkai/.cache/agentic_recommender/lightgcn/data_se_embeddings.pkl
[LightGCNManager] Cache key matches, loading embeddings...
[0m[22:25:01] [INFO] LightGCN stats: {'fitted': True, 'num_users': 109544, 'num_cuisines': 39, 'embedding_dim': 64, 'n_layers': 3, 'cache_key': 'e7bbc21597e03bb9a21bc1c70dab3213'}[0m
[0m[22:25:01] [INFO] [0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] INITIALIZING LLM PROVIDER[0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] Provider type: openrouter[0m
[92m[22:25:01] [SUCCESS] Initialized OpenRouter[0m
[0m[22:25:01] [INFO] [0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] RUNNING ENHANCED TWO-ROUND EVALUATION[0m
[0m[22:25:01] [INFO] ============================================================[0m
[0m[22:25:01] [INFO] Samples: 10, Candidates: 20[0m

[1/10] Customer: 3097f3b1ff
  Candidates: 9
  GT rank: 2, added: True
  Round 1 rank: 2
  Round 2 (final) rank: 2
  Time: 167000.56ms

[2/10] Customer: 0ad4c8de01
  Candidates: 8
  GT rank: 7, added: True
  Round 1 rank: 7
  Round 2 (final) rank: 1
  Time: 204325.91ms

[3/10] Customer: 7a79cfbcb0
  Candidates: 6
  GT rank: 5, added: True
  Round 1 rank: 6
  Round 2 (final) rank: 1
  Time: 52127.69ms

[4/10] Customer: 6c6a1d2c7f
  Candidates: 6
  GT rank: 2, added: True
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 67258.57ms

[5/10] Customer: 62a29e83ed
  Candidates: 8
  GT rank: 3, added: False
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 92374.07ms

[6/10] Customer: 3d6bf79aa6
  Candidates: 7
  GT rank: 1, added: False
  Round 1 rank: 4
  Round 2 (final) rank: 1
  Time: 21168.07ms

[7/10] Customer: 2ce1f1d7ba
  Candidates: 6
  GT rank: 2, added: True
  Round 1 rank: 3
  Round 2 (final) rank: 2
  Time: 721110.43ms

[8/10] Customer: f3c6aceec5
  Candidates: 6
  GT rank: 2, added: False
  Round 1 rank: 1
  Round 2 (final) rank: 1
  Time: 60507.31ms

[9/10] Customer: 25e02fadab
  Candidates: 11
  GT rank: 4, added: True
  Round 1 rank: 4
  Round 2 (final) rank: 1
  Time: 181075.64ms

[10/10] Customer: bdc0d11150
  Candidates: 6
  GT rank: 4, added: False
  Round 1 rank: 4
  Round 2 (final) rank: 1
  Time: 58088.37ms
[0m[22:52:06] [INFO] [0m
[0m[22:52:06] [INFO] ============================================================[0m
[0m[22:52:06] [INFO] ENHANCED RERANK EVALUATION RESULTS[0m
[0m[22:52:06] [INFO] ============================================================[0m
[0m[22:52:06] [INFO]   NDCG@5:       0.9262[0m
[0m[22:52:06] [INFO]   NDCG@10:      0.9262[0m
[0m[22:52:06] [INFO]   MRR@5:        0.9000[0m
[0m[22:52:06] [INFO]   MRR@10:       0.9000[0m
[0m[22:52:06] [INFO]   Hit@1:        80.00%[0m
[0m[22:52:06] [INFO]   Hit@3:        100.00%[0m
[0m[22:52:06] [INFO]   Hit@5:        100.00%[0m
[0m[22:52:06] [INFO]   Hit@10:       100.00%[0m
[0m[22:52:06] [INFO]   Round1 Hit@5: 80.00%[0m
[0m[22:52:06] [INFO]   Final Hit@5:  100.00%[0m
[0m[22:52:06] [INFO]   Improvement:  +20.00%[0m
[0m[22:52:06] [INFO]   GT in Candidates: 40.00%[0m
[0m[22:52:06] [INFO]   Samples: 10/10[0m
[0m[22:52:06] [INFO]   Avg Time: 162503.66ms[0m
[96m[22:52:06] [FILE] WRITING: outputs/202601222224/stage8_enhanced_rerank_results.json (358.0 B) - Enhanced rerank evaluation metrics[0m
[96m[22:52:06] [FILE] WRITING: outputs/202601222224/stage8_enhanced_rerank_detailed.json (63.6 KB) - 10 detailed results[0m
[96m[22:52:06] [FILE] WRITING: outputs/202601222224/stage8_enhanced_rerank_detailed_preview.json (19.6 KB) - 3 records preview[0m
[92m[22:52:06] [SUCCESS] STAGE run_enhanced_rerank_evaluation COMPLETED in 1626.35s[0m
[92m[22:52:06] [SUCCESS] ----------------------------------------------------------------------[0m
[0m[22:52:07] [INFO] [0m
[0m[22:52:07] [INFO] ################################################################################[0m
[0m[22:52:07] [INFO] WORKFLOW COMPLETE[0m
[0m[22:52:07] [INFO] ################################################################################[0m
[0m[22:52:07] [INFO] 
Total time: 1656.67s[0m
[0m[22:52:07] [INFO] 
Results:[0m
[0m[22:52:07] [INFO]   load_data: SUCCESS[0m
[0m[22:52:07] [INFO]   build_users: SUCCESS[0m
[0m[22:52:07] [INFO]   build_cuisines: SUCCESS[0m
[0m[22:52:07] [INFO]   run_enhanced_rerank_evaluation: SUCCESS[0m
